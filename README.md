# Incident Tracker API

## Конфигурация

Для конфигурации приложения используется файл `.env`, для удобства запуска и проверки он уже расположен в репозитории и сконфигурирован для запуска с помощью `Docker`.

## Запуск с помощью `Docker`

> [!NOTE]
> При запуске с помощью `Docker` также запускается контейнер с базой данных, если вам необходимо использовать локальную базу, приложение необходимо запустить локально.

> [!WARNING]
> `Docker` должен быть установлен на вашей машине!

Для запуска приложения с помощью `Docker` введите следующую команду:
```sh
docker compose up -d
```

Приложение будет доступно по адресу `localhost:8000`, или на порте, указанном в переменной `APP_PORT` в файле `.env`.

## Запуск локально

> [!WARNING]
> `Python` версии не ниже 3.12 должен быть установлен на вашей машине!

### Установка зависимостей

Если вы используете `uv`, введите следующую команду:
```sh
uv sync --locked
uv venv
source .venv/bin/activate
``` 
иначе используйте `pip`:
```sh
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### Запуск

> [!WARNING]
> Программа расчитана на использование `PostgreSQL`, если хотите воспользоваться другой СУБД, установите соответствующие зависимости и измените движок в файле `src/settings.py`
> Перед запуском убедитесь, что данные для подключения к базе данных в файле `.env` соответствую вашей локально запущенной базе данных!

Перед первым запуском проведите миграции базы данных:
```sh
alembic upgrade head
```

Запустите приложение локально с помощью следующей команды:
```sh
uvicorn src.main:app --host 0.0.0.0 --port 8000
```

Приложение будет доступно по адресу `localhost:8000`.

## Использование

После запуска приложения, документация OpenAPI будет доступна на эндпоинте `/docs`. Если вы запустили приложение на порте 8000, перейдите по [ссылке](localhost:8000/docs).

Реализовано 3 эндпоинта:
 - `POST /api/v1/incidents/` - создает новый инцидент, в теле запроса передается объект со строковыми полями `description` и `source`. Размер строки в поле `description` не должен превышать 500 символов, в параметр `source` должна быть указана одна из строк: `operator`, `monitoring`, `partner` или `client`.
 - `GET /api/vi/incidents/?status=<status>` - возвращает список инцидентов, парметр `status` является опциональным и должен принимать одно из значений: `open`, `reopen`, `in_progress`, `resolved` или `closed`.
 - `PUT /api/v1/incidents/<incident_id>/status/` - изменяет статус инцидента с `id` `incident_id`, в теле запроса передается объект с полем `source`, которое принимает одно из значений, описаных в первом эндпоинте.

